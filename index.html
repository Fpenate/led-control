<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de LED ESP32</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    button {
      font-size: 20px;
      margin: 10px;
      padding: 10px 30px;
    }
    .estado {
      font-size: 24px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Controlar LED ESP32</h1>
  <button onclick="actualizarLed(1)">Encender</button>
  <button onclick="actualizarLed(0)">Apagar</button>
  <div class="estado" id="estadoLed">Estado: Desconocido</div>

  <script>
    const WRITE_API_KEY = "PF4OJMV9TVJWSTOZ";
    const CHANNEL_ID = "2976944";
    const READ_API_KEY = "24DWHWZEL6XS8M5V";

    function actualizarLed(valor) {
      fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field1=${valor}`)
        .then(response => response.text())
        .then(data => {
          console.log("Respuesta de ThingSpeak:", data);
          setTimeout(verEstado, 1000);
        });
    }

    function verEstado() {
      fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/fields/1/last.txt?api_key=${READ_API_KEY}`)
        .then(response => response.text())
        .then(valor => {
          const estado = parseInt(valor.trim()) === 1 ? "Encendido ðŸ”†" : "Apagado ðŸŒ‘";
          document.getElementById("estadoLed").innerText = "Estado: " + estado;
        });
    }

    setInterval(verEstado, 5000);
    verEstado(); // Cargar estado al abrir
  </script>
</body>
</html>
